<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>ZMImageDownsampleOperation.m - Slather</title>
<link href="slather.css" media="all" rel="stylesheet">
</head>
<body>
<header><div class="row"><a href="index.html"><img src="logo.jpg" alt="Slather logo"></a></div></header><div class="row"><div id="reports">
<h2 class="cov_title">
<span>Coverage for "ZMImageDownsampleOperation.m" : </span><span class="cov_medium">77.19%</span>
</h2>
<h4 class="cov_subtitle">(335 of 434 relevant lines covered)</h4>
<h4 class="cov_filepath">../Desktop/jenkins-agent/workspace/Utility jobs/Create a new version of framework/Sources/Image Processing/ZMImageDownsampleOperation.m</h4>
<table class="source_code">
<tr class="never">
<td class="num">1</td>
<td class="src"><pre><code class="objc">// </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2</td>
<td class="src"><pre><code class="objc">// Wire</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">3</td>
<td class="src"><pre><code class="objc">// Copyright (C) 2016 Wire Swiss GmbH</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">4</td>
<td class="src"><pre><code class="objc">// </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">5</td>
<td class="src"><pre><code class="objc">// This program is free software: you can redistribute it and/or modify</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">6</td>
<td class="src"><pre><code class="objc">// it under the terms of the GNU General Public License as published by</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">7</td>
<td class="src"><pre><code class="objc">// the Free Software Foundation, either version 3 of the License, or</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">8</td>
<td class="src"><pre><code class="objc">// (at your option) any later version.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">9</td>
<td class="src"><pre><code class="objc">// </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">10</td>
<td class="src"><pre><code class="objc">// This program is distributed in the hope that it will be useful,</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">11</td>
<td class="src"><pre><code class="objc">// but WITHOUT ANY WARRANTY; without even the implied warranty of</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">12</td>
<td class="src"><pre><code class="objc">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">13</td>
<td class="src"><pre><code class="objc">// GNU General Public License for more details.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">14</td>
<td class="src"><pre><code class="objc">// </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">15</td>
<td class="src"><pre><code class="objc">// You should have received a copy of the GNU General Public License</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">16</td>
<td class="src"><pre><code class="objc">// along with this program. If not, see http://www.gnu.org/licenses/.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">17</td>
<td class="src"><pre><code class="objc">// </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">18</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">19</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">20</td>
<td class="src"><pre><code class="objc">@import CoreGraphics;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">21</td>
<td class="src"><pre><code class="objc">@import ImageIO;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">22</td>
<td class="src"><pre><code class="objc">@import ZMCSystem;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">23</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">24</td>
<td class="src"><pre><code class="objc">#if TARGET_OS_IPHONE</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">25</td>
<td class="src"><pre><code class="objc">@import MobileCoreServices;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">26</td>
<td class="src"><pre><code class="objc">#endif</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">27</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">28</td>
<td class="src"><pre><code class="objc">#import "ZMImageDownsampleOperation.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">29</td>
<td class="src"><pre><code class="objc">#import "ZMImageLoadOperation.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">30</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">31</td>
<td class="src"><pre><code class="objc">static const NSUInteger MaximumGIFImageByteCount = 5 * 1024 * 1024;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">32</td>
<td class="src"><pre><code class="objc">static const double DownsampleResizeThreshold = 1.2;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">33</td>
<td class="src"><pre><code class="objc">static const int TiffOrientationCorrect = 1;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">34</td>
<td class="src"><pre><code class="objc">static const int TiffOrientationNotSet = 0;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">35</td>
<td class="src"><pre><code class="objc">static const double ScaleFudgeFactor = 1.3; ///&lt; We will not require scaling if the image is within 30% of the target size</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">36</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">37</td>
<td class="src"><pre><code class="objc">static BOOL isFormatKindOfFormat(NSString *format1, CFStringRef format2) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">38</td>
<td class="src"><pre><code class="objc">    return (BOOL) UTTypeConformsTo((__bridge CFStringRef) format1, format2);</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">39</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="never">
<td class="num">40</td>
<td class="src"><pre><code class="objc">static CGContextRef createBitmapContext(size_t width, size_t height);</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">41</td>
<td class="src"><pre><code class="objc">static void bitmapContextReleaseData(void *releaseInfo, void *data);</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">42</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">43</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">44</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">45</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">46</td>
<td class="src"><pre><code class="objc">@interface ZMImageDownsampleOperation ()</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">47</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">48</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMImageLoadOperation *loadOperation;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">49</td>
<td class="src"><pre><code class="objc">@property (nonatomic, copy) NSData *downsampleImageData;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">50</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMImageDownsampleType downsampleType;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">51</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSString *imageFormat;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">52</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMImageFormat format;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">53</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMIImageProperties *properties;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">54</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">55</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">56</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">57</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">58</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">59</td>
<td class="src"><pre><code class="objc">@implementation ZMImageDownsampleOperation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">60</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">61</td>
<td class="src"><pre><code class="objc">+ (ZMImageDownsampleType)downsampleTypeForImageFormat:(ZMImageFormat)format</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">62</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">63</td>
<td class="src"><pre><code class="objc">    switch (format) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">64</td>
<td class="src"><pre><code class="objc">        case ZMImageFormatPreview:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">65</td>
<td class="src"><pre><code class="objc">            return ZMImageDownsampleTypePreview;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">66</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">67</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">68</td>
<td class="src"><pre><code class="objc">        case ZMImageFormatMedium:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">69</td>
<td class="src"><pre><code class="objc">            return ZMImageDownsampleTypeMedium;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">70</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">71</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">72</td>
<td class="src"><pre><code class="objc">        case ZMImageFormatProfile:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">73</td>
<td class="src"><pre><code class="objc">            return ZMImageDownsampleTypeSmallProfile;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">74</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">75</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">76</td>
<td class="src"><pre><code class="objc">        case ZMImageFormatInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">77</td>
<td class="src"><pre><code class="objc">        case ZMImageFormatOriginal:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">78</td>
<td class="src"><pre><code class="objc">        default:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">79</td>
<td class="src"><pre><code class="objc">            RequireString(NO, "Unknown image format for downsampling: %ld", (long)format);</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">80</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">81</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">82</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">83</td>
<td class="src"><pre><code class="objc">    return ZMImageDownsampleTypeInvalid;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">84</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">85</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">86</td>
<td class="src"><pre><code class="objc">+ (ZMImageFormat)imageFormatForDownsampleType:(ZMImageDownsampleType)format</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">87</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="missed">
<td class="num">88</td>
<td class="src"><pre><code class="objc">    switch (format) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">89</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">90</td>
<td class="src"><pre><code class="objc">            return ZMImageFormatPreview;</code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="missed">
<td class="num">91</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">92</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">93</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">30x</td>
</tr>
<tr class="covered">
<td class="num">94</td>
<td class="src"><pre><code class="objc">            return ZMImageFormatMedium;</code></pre></td>
<td class="coverage">30x</td>
</tr>
<tr class="missed">
<td class="num">95</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">96</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">97</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">98</td>
<td class="src"><pre><code class="objc">            return ZMImageFormatProfile;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="missed">
<td class="num">99</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">100</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="missed">
<td class="num">101</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">102</td>
<td class="src"><pre><code class="objc">        default:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">103</td>
<td class="src"><pre><code class="objc">            RequireString(NO, "Unknown image format for downsampling: %ld", (long)format);</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">104</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">105</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">106</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">107</td>
<td class="src"><pre><code class="objc">    return ZMImageFormatInvalid;</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">108</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="never">
<td class="num">109</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">110</td>
<td class="src"><pre><code class="objc">- (instancetype)initWithLoadOperation:(ZMImageLoadOperation *)loadOperation downsampleType:(ZMImageDownsampleType)downsampleType;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">111</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">112</td>
<td class="src"><pre><code class="objc">    self = [super init];</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">113</td>
<td class="src"><pre><code class="objc">    if (self) {</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">114</td>
<td class="src"><pre><code class="objc">        self.loadOperation = loadOperation;</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">115</td>
<td class="src"><pre><code class="objc">        if (self.loadOperation == nil) {</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="missed">
<td class="num">116</td>
<td class="src"><pre><code class="objc">            return nil;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">117</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">118</td>
<td class="src"><pre><code class="objc">        [self addDependency:self.loadOperation];</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">119</td>
<td class="src"><pre><code class="objc">        self.downsampleType = downsampleType;</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">120</td>
<td class="src"><pre><code class="objc">        self.format = [ZMImageDownsampleOperation imageFormatForDownsampleType:downsampleType];</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">121</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">122</td>
<td class="src"><pre><code class="objc">    return self;</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="covered">
<td class="num">123</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">53x</td>
</tr>
<tr class="never">
<td class="num">124</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">125</td>
<td class="src"><pre><code class="objc">- (instancetype)initWithLoadOperation:(ZMImageLoadOperation *)loadOperation format:(ZMImageFormat)format;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">126</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">127</td>
<td class="src"><pre><code class="objc">    self = [self initWithLoadOperation:loadOperation downsampleType:[ZMImageDownsampleOperation downsampleTypeForImageFormat:format]];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">128</td>
<td class="src"><pre><code class="objc">    if (self) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">129</td>
<td class="src"><pre><code class="objc">        self.format = format;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">130</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">131</td>
<td class="src"><pre><code class="objc">    return self;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">132</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">133</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">134</td>
<td class="src"><pre><code class="objc">- (NSString *)description</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">135</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">136</td>
<td class="src"><pre><code class="objc">    NSString *typeName = @"Invalid";</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">137</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">138</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">139</td>
<td class="src"><pre><code class="objc">            typeName = @"Preview";</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">140</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">141</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">142</td>
<td class="src"><pre><code class="objc">            typeName = @"Medium";</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">143</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">144</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">145</td>
<td class="src"><pre><code class="objc">            typeName = @"SmallProfile";</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">146</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">147</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">148</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">149</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">150</td>
<td class="src"><pre><code class="objc">    return [NSString stringWithFormat:@"&lt;%@: %p&gt; \"%@\" input: %@",</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">151</td>
<td class="src"><pre><code class="objc">            self.class, self,</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">152</td>
<td class="src"><pre><code class="objc">            typeName,</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">153</td>
<td class="src"><pre><code class="objc">            self.loadOperation.inputDescription];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">154</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">155</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">156</td>
<td class="src"><pre><code class="objc">- (void)main</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">157</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">51x</td>
</tr>
<tr class="covered">
<td class="num">158</td>
<td class="src"><pre><code class="objc">    self.imageFormat = self.loadOperation.computedImageProperties.mimeType;</code></pre></td>
<td class="coverage">51x</td>
</tr>
<tr class="covered">
<td class="num">159</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">51x</td>
</tr>
<tr class="covered">
<td class="num">160</td>
<td class="src"><pre><code class="objc">    if (self.isCancelled || (self.loadOperation.CGImage == NULL)) {</code></pre></td>
<td class="coverage">51x</td>
</tr>
<tr class="covered">
<td class="num">161</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">162</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">163</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">51x</td>
</tr>
<tr class="covered">
<td class="num">164</td>
<td class="src"><pre><code class="objc">    const CGImageRef image = self.forceSquare ? [self squareImage] : [self rotatedImage];</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">165</td>
<td class="src"><pre><code class="objc">    CGSize imageSize = CGSizeMake(CGImageGetWidth(image), CGImageGetHeight(image));</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">166</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">167</td>
<td class="src"><pre><code class="objc">    NSString *mimeType = self.loadOperation.computedImageProperties.mimeType;</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">168</td>
<td class="src"><pre><code class="objc">    if ([self shouldScale:image]) {</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">169</td>
<td class="src"><pre><code class="objc">        imageSize = [self scaleImage:image];</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">170</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">171</td>
<td class="src"><pre><code class="objc">    else if([self originalImageByteSizeTooBig])</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">172</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">173</td>
<td class="src"><pre><code class="objc">        mimeType = [self recompressImage:image];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">174</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">175</td>
<td class="src"><pre><code class="objc">    if (self.downsampleImageData == nil) {</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">176</td>
<td class="src"><pre><code class="objc">        if(image == self.loadOperation.CGImage) {</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">177</td>
<td class="src"><pre><code class="objc">            self.downsampleImageData = self.loadOperation.originalImageData;</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">178</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">179</td>
<td class="src"><pre><code class="objc">        else {</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">180</td>
<td class="src"><pre><code class="objc">            self.downsampleImageData = [self createCompressImageDataFromImage:image format:self.loadOperation.computedImageProperties.mimeType];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">181</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">182</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">183</td>
<td class="src"><pre><code class="objc">    self.properties = [ZMIImageProperties imagePropertiesWithSize:imageSize</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">184</td>
<td class="src"><pre><code class="objc">                                                           length:self.downsampleImageData.length</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">185</td>
<td class="src"><pre><code class="objc">                                                         mimeType:CFBridgingRelease(UTTypeCopyPreferredTagWithClass((__bridge CFStringRef)mimeType, kUTTagClassMIMEType))];</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">186</td>
<td class="src"><pre><code class="objc">    CGImageRelease(image);</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">187</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="never">
<td class="num">188</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">189</td>
<td class="src"><pre><code class="objc">- (CGSize)scaleImage:(CGImageRef)image</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">190</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">191</td>
<td class="src"><pre><code class="objc">    const CGSize originalSize = CGSizeMake(CGImageGetWidth(image), CGImageGetHeight(image));</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">192</td>
<td class="src"><pre><code class="objc">    const CGSize finalSize = [self finalSizeForOriginalSize:originalSize];</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">193</td>
<td class="src"><pre><code class="objc">    CGImageRef scaledImage = [self scaleImage:image toSize:finalSize];</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">194</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">195</td>
<td class="src"><pre><code class="objc">    NSString *format = self.forceLossy ? (id)kUTTypeJPEG : self.formatForScaling;</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">196</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">197</td>
<td class="src"><pre><code class="objc">    self.downsampleImageData = [self createCompressImageDataFromImage:scaledImage format:format];</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">198</td>
<td class="src"><pre><code class="objc">    self.imageFormat = format;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">199</td>
<td class="src"><pre><code class="objc">    CGImageRelease(scaledImage);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">200</td>
<td class="src"><pre><code class="objc">    return finalSize;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">201</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="never">
<td class="num">202</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">203</td>
<td class="src"><pre><code class="objc">- (BOOL)originalImageByteSizeTooBig</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">204</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">205</td>
<td class="src"><pre><code class="objc">    const BOOL isGif = isFormatKindOfFormat(self.imageFormat, kUTTypeGIF);</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">206</td>
<td class="src"><pre><code class="objc">    if (isGif) {</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">207</td>
<td class="src"><pre><code class="objc">        return (self.loadOperation.originalImageData.length &gt; MaximumGIFImageByteCount);</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">208</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">209</td>
<td class="src"><pre><code class="objc">        return (self.loadOperation.originalImageData.length &gt; self.targetByteCount);</code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">210</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">19x</td>
</tr>
<tr class="covered">
<td class="num">211</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="never">
<td class="num">212</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">213</td>
<td class="src"><pre><code class="objc">/// Recompress image and returns new kUTType</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">214</td>
<td class="src"><pre><code class="objc">- (NSString*)recompressImage:(CGImageRef)image</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">215</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">216</td>
<td class="src"><pre><code class="objc">    // Try to recompress it to see if that helps:</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">217</td>
<td class="src"><pre><code class="objc">    NSString *format = self.forceLossy ? (id)kUTTypeJPEG : self.loadOperation.computedImageProperties.mimeType;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">218</td>
<td class="src"><pre><code class="objc">    NSData *compressedData = [self createCompressImageDataFromImage:image format:format];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">219</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">220</td>
<td class="src"><pre><code class="objc">    NSString *finalFormat = format;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">221</td>
<td class="src"><pre><code class="objc">    // too big? if not JPEG...</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">222</td>
<td class="src"><pre><code class="objc">    if(! isFormatKindOfFormat(format, kUTTypeJPEG) &amp;&amp; compressedData.length &gt; self.targetByteCount)</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">223</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">224</td>
<td class="src"><pre><code class="objc">        // Force JPEG:</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">225</td>
<td class="src"><pre><code class="objc">        compressedData = [self createCompressImageDataFromImage:image format:(__bridge id)kUTTypeJPEG];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">226</td>
<td class="src"><pre><code class="objc">        finalFormat = (__bridge NSString *)kUTTypeJPEG;</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">227</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">228</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">229</td>
<td class="src"><pre><code class="objc">    // did I not achieve any sensible compression?</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">230</td>
<td class="src"><pre><code class="objc">    if (compressedData.length * DownsampleResizeThreshold &lt; self.loadOperation.originalImageData.length)</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">231</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">232</td>
<td class="src"><pre><code class="objc">        // not worth compressing, use original</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">233</td>
<td class="src"><pre><code class="objc">        self.downsampleImageData = compressedData;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">234</td>
<td class="src"><pre><code class="objc">        finalFormat = format;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">235</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">236</td>
<td class="src"><pre><code class="objc">    return finalFormat;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">237</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">238</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">239</td>
<td class="src"><pre><code class="objc">- (BOOL)shouldScale:(CGImageRef)image</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">240</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">241</td>
<td class="src"><pre><code class="objc">    const CGSize size = CGSizeMake(CGImageGetWidth(image), CGImageGetHeight(image));</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">242</td>
<td class="src"><pre><code class="objc">    BOOL const oneSideIsToLong = ((size.width &gt; ScaleFudgeFactor * self.targetDimension) || (size.height &gt; ScaleFudgeFactor * self.targetDimension));</code></pre></td>
<td class="coverage">17x</td>
</tr>
<tr class="covered">
<td class="num">243</td>
<td class="src"><pre><code class="objc">    double const MaxPixelCount = ScaleFudgeFactor * self.targetDimension * self.targetDimension;</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">244</td>
<td class="src"><pre><code class="objc">    BOOL const pixelCountIsTooBig = (size.width * size.height &gt; MaxPixelCount);</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">245</td>
<td class="src"><pre><code class="objc">    return (oneSideIsToLong &amp;&amp; pixelCountIsTooBig);</code></pre></td>
<td class="coverage">30x</td>
</tr>
<tr class="covered">
<td class="num">246</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="never">
<td class="num">247</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">248</td>
<td class="src"><pre><code class="objc">- (NSUInteger)targetByteCount</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">249</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="missed">
<td class="num">250</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">251</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">41x</td>
</tr>
<tr class="covered">
<td class="num">252</td>
<td class="src"><pre><code class="objc">            return 310 * 1024;</code></pre></td>
<td class="coverage">41x</td>
</tr>
<tr class="covered">
<td class="num">253</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">254</td>
<td class="src"><pre><code class="objc">            return 1024;</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">255</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">256</td>
<td class="src"><pre><code class="objc">            return 1024 * 1024; // Don't care about this</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="missed">
<td class="num">257</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">258</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">259</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">260</td>
<td class="src"><pre><code class="objc">    VerifyActionString(NO, return 0, "Invalid downsample type");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">261</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="never">
<td class="num">262</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">263</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">264</td>
<td class="src"><pre><code class="objc">- (NSUInteger)targetDimension</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">265</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">242x</td>
</tr>
<tr class="missed">
<td class="num">266</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">267</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">134x</td>
</tr>
<tr class="covered">
<td class="num">268</td>
<td class="src"><pre><code class="objc">            return 1448;</code></pre></td>
<td class="coverage">134x</td>
</tr>
<tr class="covered">
<td class="num">269</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">270</td>
<td class="src"><pre><code class="objc">            return 30;</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">271</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">272</td>
<td class="src"><pre><code class="objc">            return 280;</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="missed">
<td class="num">273</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">274</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">275</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">276</td>
<td class="src"><pre><code class="objc">    VerifyActionString(NO, return 0, "Invalid downsample type");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">277</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">242x</td>
</tr>
<tr class="never">
<td class="num">278</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">279</td>
<td class="src"><pre><code class="objc">- (double)compressionQuality;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">280</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="missed">
<td class="num">281</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">282</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">283</td>
<td class="src"><pre><code class="objc">            return 0.45;</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">284</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">285</td>
<td class="src"><pre><code class="objc">            return 0;</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">286</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">287</td>
<td class="src"><pre><code class="objc">            return 0.7;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="missed">
<td class="num">288</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">289</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">290</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">291</td>
<td class="src"><pre><code class="objc">    VerifyActionString(NO, return 0, "Invalid downsample type");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">292</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="never">
<td class="num">293</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">294</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">295</td>
<td class="src"><pre><code class="objc">- (NSDictionary *)outputProperties</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">296</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">297</td>
<td class="src"><pre><code class="objc">    NSMutableDictionary *properties = nil;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">298</td>
<td class="src"><pre><code class="objc">    if (self.downsampleType == ZMImageDownsampleTypeMedium) {</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">299</td>
<td class="src"><pre><code class="objc">        properties = [NSMutableDictionary dictionaryWithDictionary:self.loadOperation.sourceImageProperties];</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">300</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">301</td>
<td class="src"><pre><code class="objc">    else if (self.downsampleType == ZMImageDownsampleTypePreview) {</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">302</td>
<td class="src"><pre><code class="objc">        properties = [self justOrientationExifProperties];</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">303</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">304</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">305</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">306</td>
<td class="src"><pre><code class="objc">    if ((self.loadOperation.tiffOrientation != TiffOrientationCorrect) &amp;&amp;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">307</td>
<td class="src"><pre><code class="objc">        (self.loadOperation.tiffOrientation != TiffOrientationNotSet))</code></pre></td>
<td class="coverage">35x</td>
</tr>
<tr class="covered">
<td class="num">308</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">309</td>
<td class="src"><pre><code class="objc">        properties[(__bridge id) kCGImagePropertyOrientation] = @(TiffOrientationCorrect);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">310</td>
<td class="src"><pre><code class="objc">        if (properties[(__bridge id) kCGImagePropertyTIFFDictionary]) {</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">311</td>
<td class="src"><pre><code class="objc">            NSMutableDictionary *tiffDictionary = [NSMutableDictionary dictionaryWithDictionary:properties[(__bridge id) kCGImagePropertyTIFFDictionary]];</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">312</td>
<td class="src"><pre><code class="objc">            tiffDictionary[(__bridge id) kCGImagePropertyTIFFOrientation] = @(TiffOrientationCorrect);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">313</td>
<td class="src"><pre><code class="objc">            properties[(__bridge id) kCGImagePropertyTIFFDictionary] = tiffDictionary;</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">314</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">315</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">316</td>
<td class="src"><pre><code class="objc">    properties[(__bridge id) kCGImageDestinationLossyCompressionQuality] = @(self.compressionQuality);</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">317</td>
<td class="src"><pre><code class="objc">    return properties;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">318</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="never">
<td class="num">319</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">320</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">321</td>
<td class="src"><pre><code class="objc">- (NSMutableDictionary *)justOrientationExifProperties</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">322</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">323</td>
<td class="src"><pre><code class="objc">    NSMutableDictionary *properties = [NSMutableDictionary dictionary];</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">324</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">325</td>
<td class="src"><pre><code class="objc">    NSNumber *orientation = self.loadOperation.sourceImageProperties[(__bridge id) kCGImagePropertyTIFFDictionary][(__bridge id) kCGImagePropertyTIFFOrientation];</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">326</td>
<td class="src"><pre><code class="objc">    if (orientation != nil) {</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">327</td>
<td class="src"><pre><code class="objc">        NSMutableDictionary *tiffDict = [NSMutableDictionary dictionary];</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">328</td>
<td class="src"><pre><code class="objc">        tiffDict[(__bridge id) kCGImagePropertyTIFFOrientation] = orientation;</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">329</td>
<td class="src"><pre><code class="objc">        properties[(__bridge id) kCGImagePropertyTIFFDictionary] = tiffDict;</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">330</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">331</td>
<td class="src"><pre><code class="objc">    return properties;</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">332</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="never">
<td class="num">333</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">334</td>
<td class="src"><pre><code class="objc">- (NSData *)createCompressImageDataFromImage:(CGImageRef)image format:(NSString *)format</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">335</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">336</td>
<td class="src"><pre><code class="objc">    NSData *result = nil;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">337</td>
<td class="src"><pre><code class="objc">    NSMutableData *data = [NSMutableData dataWithCapacity:(NSUInteger) llround(self.targetByteCount * 1.5)];</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">338</td>
<td class="src"><pre><code class="objc">    CGImageDestinationRef dest = CGImageDestinationCreateWithData((__bridge CFMutableDataRef) data, (__bridge CFStringRef) format, 1, NULL);</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">339</td>
<td class="src"><pre><code class="objc">    if (dest != NULL) {</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">340</td>
<td class="src"><pre><code class="objc">        CGImageDestinationAddImage(dest, image, (__bridge CFDictionaryRef) self.outputProperties);</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">341</td>
<td class="src"><pre><code class="objc">        if (CGImageDestinationFinalize(dest)) {</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">342</td>
<td class="src"><pre><code class="objc">            result = data;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">343</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">344</td>
<td class="src"><pre><code class="objc">        CFRelease(dest);</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">345</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">346</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">347</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="never">
<td class="num">348</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">349</td>
<td class="src"><pre><code class="objc">- (NSString *)formatForScaling</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">350</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">351</td>
<td class="src"><pre><code class="objc">    return (__bridge id)kUTTypeJPEG;</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">352</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="never">
<td class="num">353</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">354</td>
<td class="src"><pre><code class="objc">- (BOOL)forceLossy</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">355</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="missed">
<td class="num">356</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">357</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">358</td>
<td class="src"><pre><code class="objc">            return NO;</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">359</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">17x</td>
</tr>
<tr class="covered">
<td class="num">360</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">17x</td>
</tr>
<tr class="covered">
<td class="num">361</td>
<td class="src"><pre><code class="objc">            return YES;</code></pre></td>
<td class="coverage">17x</td>
</tr>
<tr class="missed">
<td class="num">362</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">363</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">364</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">365</td>
<td class="src"><pre><code class="objc">    VerifyActionString(NO, return NO, "Invalid downsample type");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">366</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="never">
<td class="num">367</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">368</td>
<td class="src"><pre><code class="objc">- (BOOL)forceSquare</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">369</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="missed">
<td class="num">370</td>
<td class="src"><pre><code class="objc">    switch (self.downsampleType) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">371</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeSmallProfile:</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">372</td>
<td class="src"><pre><code class="objc">            return YES;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">373</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeMedium:</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">374</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypePreview:</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">375</td>
<td class="src"><pre><code class="objc">            return NO;</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="missed">
<td class="num">376</td>
<td class="src"><pre><code class="objc">        case ZMImageDownsampleTypeInvalid:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">377</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">378</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">379</td>
<td class="src"><pre><code class="objc">    VerifyActionString(NO, return NO, "Invalid downsample type");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">380</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="never">
<td class="num">381</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">382</td>
<td class="src"><pre><code class="objc">- (CGImageRef)squareImage CF_RETURNS_RETAINED</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">383</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">384</td>
<td class="src"><pre><code class="objc">    CGImageRef const image = [self rotatedImage];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">385</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">386</td>
<td class="src"><pre><code class="objc">    CGSize const imageSize = CGSizeMake(CGImageGetWidth(image), CGImageGetHeight(image));</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">387</td>
<td class="src"><pre><code class="objc">    CGFloat const shortestSide = (CGFloat) fmin(imageSize.width,</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">388</td>
<td class="src"><pre><code class="objc">                                      imageSize.height);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">389</td>
<td class="src"><pre><code class="objc">    CGFloat const width = (CGFloat) floor(fmin(self.targetDimension, shortestSide));</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">390</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">391</td>
<td class="src"><pre><code class="objc">    CGContextRef context = createBitmapContext((size_t) width, (size_t) width);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">392</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">393</td>
<td class="src"><pre><code class="objc">    CGFloat const scale = ((CGFloat) width) / ((CGFloat) shortestSide);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">394</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">395</td>
<td class="src"><pre><code class="objc">    CGRect r = CGRectMake(0,</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">396</td>
<td class="src"><pre><code class="objc">                          0,</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">397</td>
<td class="src"><pre><code class="objc">                          scale * imageSize.width,</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">398</td>
<td class="src"><pre><code class="objc">                          scale * imageSize.height);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">399</td>
<td class="src"><pre><code class="objc">    if (imageSize.width &lt; imageSize.height) {</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">400</td>
<td class="src"><pre><code class="objc">        r.origin.y = (CGFloat) (- (imageSize.height - imageSize.width) * scale * 0.5);</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">401</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">402</td>
<td class="src"><pre><code class="objc">        r.origin.x = (CGFloat) (- (imageSize.width - imageSize.height) * scale * 0.5);</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">403</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">404</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">405</td>
<td class="src"><pre><code class="objc">    CGContextDrawImage(context, r, image);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">406</td>
<td class="src"><pre><code class="objc">    CGContextFlush(context);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">407</td>
<td class="src"><pre><code class="objc">    CGImageRef result = CGBitmapContextCreateImage(context);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">408</td>
<td class="src"><pre><code class="objc">    CGContextRelease(context);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">409</td>
<td class="src"><pre><code class="objc">    CFRelease(image);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">410</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">411</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">412</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="never">
<td class="num">413</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">414</td>
<td class="src"><pre><code class="objc">- (CGImageRef)rotatedImage CF_RETURNS_RETAINED</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">415</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">416</td>
<td class="src"><pre><code class="objc">    CGImageRef image = [self.loadOperation CGImage];</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">417</td>
<td class="src"><pre><code class="objc">    int orientation = [self.loadOperation tiffOrientation];</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">418</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">419</td>
<td class="src"><pre><code class="objc">    if ((orientation == TiffOrientationCorrect) ||</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">420</td>
<td class="src"><pre><code class="objc">        (orientation == TiffOrientationNotSet))</code></pre></td>
<td class="coverage">35x</td>
</tr>
<tr class="covered">
<td class="num">421</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">422</td>
<td class="src"><pre><code class="objc">        return CGImageRetain(image);</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">423</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">424</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="covered">
<td class="num">425</td>
<td class="src"><pre><code class="objc">    CGImageRef i = [self rotateImageWithEXIF:image orientation:orientation];</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">426</td>
<td class="src"><pre><code class="objc">    return i;</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">427</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">47x</td>
</tr>
<tr class="never">
<td class="num">428</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">429</td>
<td class="src"><pre><code class="objc">- (CGSize)finalSizeForOriginalSize:(CGSize)originalSize</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">430</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">431</td>
<td class="src"><pre><code class="objc">    VerifyReturnValue(originalSize.width &gt; 0 &amp;&amp; originalSize.height &gt; 0, CGSizeMake(1, 1));</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">432</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">433</td>
<td class="src"><pre><code class="objc">    double const scale1 = fmax(self.targetDimension / (double) originalSize.width,</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">434</td>
<td class="src"><pre><code class="objc">                                   self.targetDimension / (double) originalSize.height);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">435</td>
<td class="src"><pre><code class="objc">    double const scale2 = self.targetDimension / sqrt(originalSize.width * originalSize.height);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">436</td>
<td class="src"><pre><code class="objc">    double const scale =  (isfinite(scale2) &amp;&amp; (scale2 &lt; scale1)) ? 0.5 * (scale2 + scale1) : scale1;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">437</td>
<td class="src"><pre><code class="objc">    CGSize result = CGSizeZero;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">438</td>
<td class="src"><pre><code class="objc">    result.width = (CGFloat) ceil(scale * originalSize.width);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">439</td>
<td class="src"><pre><code class="objc">    result.height = (CGFloat) round(result.width / originalSize.width * originalSize.height);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">440</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">441</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="never">
<td class="num">442</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">443</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">444</td>
<td class="src"><pre><code class="objc">- (CGImageRef)scaleImage:(CGImageRef)image toSize:(CGSize)finalSize CF_RETURNS_RETAINED</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">445</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">446</td>
<td class="src"><pre><code class="objc">	CGContextRef ctx = createBitmapContext((size_t) finalSize.width, (size_t) finalSize.height);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">447</td>
<td class="src"><pre><code class="objc">	CGContextSetInterpolationQuality(ctx, kCGInterpolationHigh);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">448</td>
<td class="src"><pre><code class="objc">	if (image != NULL) {</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">449</td>
<td class="src"><pre><code class="objc">		CGContextDrawImage(ctx, CGRectMake(0, 0, finalSize.width, finalSize.height), image);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">450</td>
<td class="src"><pre><code class="objc">	}</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">451</td>
<td class="src"><pre><code class="objc">	CGImageRef result = CGBitmapContextCreateImage(ctx);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">452</td>
<td class="src"><pre><code class="objc">	CFRelease(ctx);</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">453</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="covered">
<td class="num">454</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">27x</td>
</tr>
<tr class="never">
<td class="num">455</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">456</td>
<td class="src"><pre><code class="objc">- (CGImageRef)rotateImageWithEXIF:(CGImageRef)source orientation:(int) orientation CF_RETURNS_RETAINED</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">457</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="missed">
<td class="num">458</td>
<td class="src"><pre><code class="objc">    switch (orientation)</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">459</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">460</td>
<td class="src"><pre><code class="objc">        case 2:</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">461</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:0 flipX:YES flipY:NO];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">462</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">463</td>
<td class="src"><pre><code class="objc">        case 3:</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">464</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:0 flipX:YES flipY:YES];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="missed">
<td class="num">465</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">466</td>
<td class="src"><pre><code class="objc">        case 4:</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">467</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:0 flipX:NO flipY:YES];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">468</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">469</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">470</td>
<td class="src"><pre><code class="objc">        case 5:</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">471</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:90 flipX:NO flipY:YES];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">472</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">473</td>
<td class="src"><pre><code class="objc">        case 6:</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">474</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:-90 flipX:NO flipY:NO];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="missed">
<td class="num">475</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">476</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">477</td>
<td class="src"><pre><code class="objc">        case 7:</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">478</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:90 flipX:YES flipY:NO];</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="missed">
<td class="num">479</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">480</td>
<td class="src"><pre><code class="objc">        case 8:</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">481</td>
<td class="src"><pre><code class="objc">            return [self rotateImageWithFlip:source angle:-90 flipX:YES flipY:YES];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="missed">
<td class="num">482</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">483</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">484</td>
<td class="src"><pre><code class="objc">        default:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">485</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">486</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">487</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="missed">
<td class="num">488</td>
<td class="src"><pre><code class="objc">    return NULL;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">489</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="never">
<td class="num">490</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">491</td>
<td class="src"><pre><code class="objc">static inline double radians (double degrees) { return degrees * M_PI/180; }</code></pre></td>
<td class="coverage">86x</td>
</tr>
<tr class="never">
<td class="num">492</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">493</td>
<td class="src"><pre><code class="objc">- (CGImageRef)rotateImageWithFlip:(CGImageRef)source angle:(float)angle flipX:(BOOL)flipX flipY:(BOOL)flipY CF_RETURNS_RETAINED</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">494</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">495</td>
<td class="src"><pre><code class="objc">    double fX    =  fabs ( cos ( radians ( angle ) ) );</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">496</td>
<td class="src"><pre><code class="objc">    double fY    =  fabs ( sin ( radians ( angle ) ) );</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">497</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">498</td>
<td class="src"><pre><code class="objc">    double dW    =  CGImageGetWidth(source) * fX + CGImageGetHeight(source) * fY;</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">499</td>
<td class="src"><pre><code class="objc">    double dH    =  CGImageGetWidth(source) * fY + CGImageGetHeight(source) * fX;</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">500</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">501</td>
<td class="src"><pre><code class="objc">    CGContextRef context = createBitmapContext((size_t)dW, (size_t)dH);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">502</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">503</td>
<td class="src"><pre><code class="objc">    CGAffineTransform transform = CGAffineTransformMakeTranslation(flipX?(CGFloat)dW:0.0f,flipY?(CGFloat)dH:0.0f);</code></pre></td>
<td class="coverage">23x</td>
</tr>
<tr class="covered">
<td class="num">504</td>
<td class="src"><pre><code class="objc">    transform = CGAffineTransformScale(transform, flipX?-1.0:1.0f,flipY?-1.0: 1.0f);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">505</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">506</td>
<td class="src"><pre><code class="objc">    if (angle != 0) {</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">507</td>
<td class="src"><pre><code class="objc">        CGAffineTransform rot = CGAffineTransformMakeTranslation ((CGFloat)dW*0.5f,(CGFloat)dH*0.5f);</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">508</td>
<td class="src"><pre><code class="objc">        rot                   = CGAffineTransformRotate(rot, (CGFloat) radians ( angle ));</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">509</td>
<td class="src"><pre><code class="objc">        rot                   = CGAffineTransformTranslate (rot,-(CGFloat)dH*0.5f,-(CGFloat)dW*0.5f);</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">510</td>
<td class="src"><pre><code class="objc">        transform             = CGAffineTransformConcat(rot, transform);</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">511</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">512</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">513</td>
<td class="src"><pre><code class="objc">    CGContextConcatCTM(context, transform);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">514</td>
<td class="src"><pre><code class="objc">    CGRect r = CGRectMake(0, 0,</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">515</td>
<td class="src"><pre><code class="objc">                          CGImageGetWidth(source), CGImageGetHeight(source));</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">516</td>
<td class="src"><pre><code class="objc">    CGContextDrawImage(context, r, source);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">517</td>
<td class="src"><pre><code class="objc">    CGContextFlush(context);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">518</td>
<td class="src"><pre><code class="objc">    CGImageRef rotated = CGBitmapContextCreateImage(context);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">519</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">520</td>
<td class="src"><pre><code class="objc">    CFRelease(context);</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">521</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">522</td>
<td class="src"><pre><code class="objc">    return rotated;</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">523</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="never">
<td class="num">524</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">525</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">526</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">527</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">528</td>
<td class="src"><pre><code class="objc">static CGContextRef createBitmapContext(size_t width, size_t height)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">529</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">530</td>
<td class="src"><pre><code class="objc">	size_t const bytesPerRow = width * 4;</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">531</td>
<td class="src"><pre><code class="objc">    size_t const bitsPerComponent = 8;</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">532</td>
<td class="src"><pre><code class="objc">	size_t const length = height * bytesPerRow;</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">533</td>
<td class="src"><pre><code class="objc">	NSMutableData *data = [NSMutableData dataWithLength:length];</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">534</td>
<td class="src"><pre><code class="objc">	CGColorSpaceRef space = CGColorSpaceCreateDeviceRGB();</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">535</td>
<td class="src"><pre><code class="objc">    NSCAssert(space != NULL, @"");</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">536</td>
<td class="src"><pre><code class="objc">	CGContextRef ctx = CGBitmapContextCreateWithData([data mutableBytes], width, height, bitsPerComponent, bytesPerRow, space, (CGBitmapInfo) kCGImageAlphaPremultipliedLast, bitmapContextReleaseData, (void *) CFBridgingRetain(data));</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">537</td>
<td class="src"><pre><code class="objc">	NSCAssert(ctx != NULL, @"");</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">538</td>
<td class="src"><pre><code class="objc">	CFRelease(space);</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">539</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">540</td>
<td class="src"><pre><code class="objc">    CGContextSetAllowsAntialiasing(ctx, NO);</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">541</td>
<td class="src"><pre><code class="objc">    CGContextSetShouldAntialias(ctx, NO);</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">542</td>
<td class="src"><pre><code class="objc">    CGContextSetInterpolationQuality(ctx, kCGInterpolationHigh);</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">543</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">544</td>
<td class="src"><pre><code class="objc">	return ctx;</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">545</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="never">
<td class="num">546</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">547</td>
<td class="src"><pre><code class="objc">static void bitmapContextReleaseData(void *releaseInfo, void * __unused data)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">548</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">549</td>
<td class="src"><pre><code class="objc">	CFTypeRef o = (CFTypeRef) releaseInfo;</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">550</td>
<td class="src"><pre><code class="objc">	if (o != NULL) {</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">551</td>
<td class="src"><pre><code class="objc">		CFRelease(o);</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">552</td>
<td class="src"><pre><code class="objc">	}</code></pre></td>
<td class="coverage">61x</td>
</tr>
<tr class="covered">
<td class="num">553</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">61x</td>
</tr>
</table>
</div></div>
<footer><div class="row">
<p><a href="https://github.com/SlatherOrg/slather">Fork me on Github</a></p>
<p>&copy; 2016 Slather</p>
</div></footer><script src="highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
